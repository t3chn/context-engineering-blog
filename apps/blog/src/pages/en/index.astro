---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("posts", ({ data }) => {
  return data.lang === "en" && !data.draft;
});

const sortedPosts = posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout title="Context Engineering Blog" lang="en">
  <!-- Hero Section -->
  <section class="mb-16 animate-fade-in">
    <div class="relative">
      <!-- Decorative element -->
      <div
        class="absolute -left-4 top-0 h-full w-1 rounded-full bg-gradient-to-b from-accent-400 via-accent-500 to-accent-600"
      >
      </div>

      <div class="pl-6">
        <p class="mb-2 font-mono text-sm uppercase tracking-widest text-[var(--color-accent)]">
          Context-First Thinking
        </p>
        <h1 class="text-4xl font-bold tracking-tight text-[var(--color-text)] sm:text-5xl">
          Context<span class="text-[var(--color-accent)]">.</span>Engineering
        </h1>
        <p class="mt-4 max-w-xl text-lg leading-relaxed text-[var(--color-text-secondary)]">
          A blog about context engineering, structuring information for LLMs and AI development.
          Practice, not theory.
        </p>
      </div>
    </div>
  </section>

  <!-- Posts Section -->
  <section>
    <div class="mb-8 flex items-center gap-4">
      <h2
        class="font-mono text-sm font-semibold uppercase tracking-widest text-[var(--color-text-secondary)]"
      >
        Latest Posts
      </h2>
      <div class="h-px flex-1 bg-[var(--color-border)]"></div>
    </div>

    {
      sortedPosts.length === 0 ? (
        <div class="rounded-lg border border-dashed border-[var(--color-border)] p-12 text-center">
          <p class="font-mono text-[var(--color-text-secondary)]">No posts yet. Coming soon!</p>
        </div>
      ) : (
        <ul class="space-y-6">
          {sortedPosts.map((post, index) => (
            <li class="animate-slide-up opacity-0" style={`animation-delay: ${0.1 + index * 0.1}s`}>
              <a href={`/en/posts/${post.id}`} class="group block">
                <article class="glass rounded-lg p-6 transition-all duration-300 hover:border-[var(--color-accent)]/50 hover:shadow-lg hover:shadow-accent-500/5">
                  <div class="flex items-start justify-between gap-4">
                    <div class="flex-1">
                      <time class="font-mono text-xs text-[var(--color-text-secondary)]">
                        {new Intl.DateTimeFormat("en-US", {
                          year: "numeric",
                          month: "short",
                          day: "numeric",
                        }).format(post.data.date)}
                      </time>
                      <h3 class="mt-2 text-xl font-semibold text-[var(--color-text)] transition-colors group-hover:text-[var(--color-accent)]">
                        {post.data.title}
                      </h3>
                      <p class="mt-2 text-[var(--color-text-secondary)] line-clamp-2">
                        {post.data.description}
                      </p>
                    </div>

                    {/* Arrow indicator */}
                    <div class="mt-8 flex h-8 w-8 items-center justify-center rounded-full border border-[var(--color-border)] text-[var(--color-text-secondary)] transition-all duration-300 group-hover:border-[var(--color-accent)] group-hover:text-[var(--color-accent)]">
                      <svg
                        class="h-4 w-4 transition-transform group-hover:translate-x-0.5"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                      </svg>
                    </div>
                  </div>

                  <div class="mt-4 flex flex-wrap gap-2">
                    {post.data.tags.map((tag) => (
                      <span class="rounded-full bg-surface-100 dark:bg-surface-800 px-3 py-1 font-mono text-xs text-[var(--color-text-secondary)]">
                        #{tag}
                      </span>
                    ))}
                  </div>
                </article>
              </a>
            </li>
          ))}
        </ul>
      )
    }
  </section>

  <!-- CTA Section -->
  <section
    class="mt-16 rounded-lg border border-[var(--color-border)] bg-[var(--color-bg-secondary)] p-8 text-center"
  >
    <p class="font-mono text-xs uppercase tracking-wider text-[var(--color-text-secondary)]">
      Follow for updates
    </p>
    <a
      href="https://t.me/ctxtdev"
      target="_blank"
      rel="noopener noreferrer"
      class="group mt-4 inline-flex items-center gap-2.5 rounded-md border border-[var(--color-border)] bg-transparent px-6 py-3 font-mono text-sm text-[var(--color-text)] transition-all duration-200 hover:border-[var(--color-accent)] hover:text-[var(--color-accent)] hover:bg-accent-500/5 focus-ring"
    >
      <svg
        class="h-4 w-4 text-[var(--color-text-secondary)] transition-colors group-hover:text-[var(--color-accent)]"
        viewBox="0 0 24 24"
        fill="currentColor"
      >
        <path
          d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"
        ></path>
      </svg>
      <span>@ctxtdev</span>
      <svg
        class="h-3 w-3 text-[var(--color-text-secondary)] transition-all group-hover:text-[var(--color-accent)] group-hover:translate-x-0.5"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"
        ></path>
      </svg>
    </a>
  </section>
</BaseLayout>
