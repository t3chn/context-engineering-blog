---
title: "Архитектура Claude Code: почему простой цикл победил сложные графы"
description: "Разбор архитектуры Claude Code по материалам выступления основателя PromptLayer. Почему while-loop, Bash и управление контекстом важнее сложных workflow."
date: 2025-12-27
tags: ["context-engineering", "claude-code", "agents", "architecture"]
lang: ru
---

## Проблема

Кодинг-агенты долго оставались игрушкой. Сложные DAG-схемы, где разработчик прописывал каждый переход: "если пользователь хочет X — иди сюда, если Y — туда". Системы получались жёсткими и хрупкими.

Claude Code работает иначе. Джаред Зонерайх из PromptLayer разобрал архитектуру на недавней конференции AI Engineer. Оказалось, что под капотом — не граф решений, а простой цикл.

## Контекст

Почему сложные схемы проваливались? Разработчики пытались программировать поведение агента императивно. Каждый edge-case требовал нового условия. Каждое условие — потенциальная точка отказа.

Современные модели достаточно умны, чтобы справляться с неопределённостью. Они могут исследовать, ошибаться и исправляться. Жёсткие схемы мешают этому.

Философия Claude Code: дайте модели инструменты и отойдите в сторону.

## Решение

### Цикл вместо графа

Архитектура Claude Code — это `while`-цикл:

```python
while has_tool_calls(response):
    results = execute_tools(response.tool_calls)
    response = model.generate(results)
```

Пока есть вызовы инструментов — выполняем их, передаём результат модели, повторяем. Никаких предопределённых путей.

### Bash как универсальный адаптер

Один из ключевых инструментов — обычный Bash. Почему это работает:

- Для Bash существует огромное количество обучающих данных
- Модель может написать Python-скрипт, запустить его через Bash, получить результат и удалить файл
- Вместо создания сотен специфических инструментов — один универсальный адаптер

Агент пробует подходы и исправляет ошибки на лету. Bash даёт ему эту гибкость.

### Контекст — главный враг

Чем больше контекста в промпте, тем хуже работает модель. Claude Code решает это несколькими способами:

**Субагенты.** Для специфических задач (чтение документации, запуск тестов) создаются отдельные агенты с чистым контекстом. Они возвращают только результат, не загрязняя основную ветку.

**Diff вместо перезаписи.** Агент не переписывает файл целиком, а создаёт изменения. Экономия токенов и снижение вероятности ошибок.

**To-do списки.** Модель ведёт структурированный план действий. Это помогает не сбиваться с пути и возобновлять работу после сбоев.

### Skills для кастомизации

Skills — расширяемые системные промпты для специфических задач. Обновление документации в вашем стиле, глубокое исследование репозитория, специфичные для команды процессы.

Это позволяет адаптировать агента без перегрузки основного контекста.

## Инсайт

Три принципа, которые объясняют работу современных кодинг-агентов:

**Доверие модели.** Не пытайтесь запрограммировать каждый случай. Модели справляются с исследованием и исправлением собственных ошибок.

**Простота архитектуры.** Zen of Python ("простое лучше сложного") работает и для агентов. Цикл вместо графа.

**Управление контекстом.** Эффективная работа с памятью модели важнее количества инструментов. Субагенты, diff, to-do списки — всё это про контекст.

Мы переходим от копирования кода из чата к headless-агентам, которые сами создают PR и чинят баги. Не потому что модели стали умнее — а потому что мы научились правильно доставлять им контекст.

## Источники

- [AI Engineer Conference — Jared Zoneraich (PromptLayer)](https://www.youtube.com/watch?v=example)
- [Claude Code Documentation](https://docs.anthropic.com/claude-code)
